@(dataFile : org.hadatac.entity.pojo.DataFile,
bSavable : Boolean,
dir: String

)

@import helper._
@import org.hadatac.utils._
@import org.hadatac.console.views.html._
@import org.hadatac.console.views.html.annotator._
@import org.hadatac.console.controllers.annotator._
@import org.hadatac.metadata.loader._
@import java.net._
@import org.hadatac.console.views.html.schema._
@import org.hadatac.console.controllers.schema._
@import org.hadatac.console.controllers._
@import org.hadatac.entity.pojo._

@main("Edit DD_2"){
    <script src="@controllers.routes.Assets.versioned("sheetjs/vendor/alertify.js")"></script>
    <script src="https://unpkg.com/canvas-datagrid/dist/canvas-datagrid.js"></script>


    <link rel="stylesheet" href="@controllers.routes.Assets.versioned("sheetjs/css/sheetjs_dd.css")">
    <link rel="stylesheet" media="screen" href="@controllers.routes.Assets.versioned("sheetjs/vendor/alertify.css")">
    
    <div id="rcorners">
    <h4>@dataFile.getFileName()</h4>
    @if(bSavable) {
        <input class="btn btn-primary" type="button" id="upload" value="Save"/>
    }
    
    
    <a href="@org.hadatac.console.controllers.annotator.routes.AutoAnnotator.downloadDataFile(dataFile.getId())" class="btn btn-primary" role="button">Download</a>
    <button type="button" class="isHeader" role="button">
        <img src="@controllers.routes.Assets.versioned("icons/header.png")"  width="36" height="30" alt=""/> Column Header 
    </button>
    <input type="text" id="headerdetails" value=" "/>
    <button type="button" class="isDesc" role="button">
        <img src="@controllers.routes.Assets.versioned("icons/notepad.png")"  width="30" height="28" alt=""/> Description
    </button>
    <input type="text" id="descdetails" value=" "/>
    <a href="@org.hadatac.console.controllers.workingfiles.routes.NewFile.index(dir)" target="_blank" class="btn btn-primary" role="button">Blank Metadata File</a>
    
    <button class="main-navi" id="showcarry"> <img src="@controllers.routes.Assets.versioned("icons/add.png")"
        width="36" height="33" alt=""/> Add to SDD</button>
        <button class="Close" id="hidecarry"> <img src="@controllers.routes.Assets.versioned("icons/add.png")"
           width="36" height="33" alt=""/> Hide</button>

    
    <div><a id="alarmmsg"></a></div>
    <div id="mobile-navi">
        <div id="ifr">
        <iframe id="iframeadd" src="@org.hadatac.console.controllers.workingfiles.routes.FileHeadersIntoSDD.createHeaders(dir, dataFile.getId())"></iframe>
    </div>
    </div>

    <script>
        function addHeaders(){
            var loc=document.getElementById("mobile-nav");
            var iframe = document.createElement('iframe');
            
            iframe.src = "@org.hadatac.console.controllers.workingfiles.routes.FileHeadersIntoSDD.createHeaders(dir, dataFile.getId())";
            loc.appendChild(iframe);

        }
    </script>
    


    <div><a id="error_msg"></a></div>
    <div id="grid"></div>
    <div id="footnote"></div>
    <div id="buttons"></div>
    </div>

    <script src="@controllers.routes.Assets.versioned("sheetjs/js/shim.js")"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="@controllers.routes.Assets.versioned("sheetjs/js/dropsheet.js")"></script>
    <script src="@controllers.routes.Assets.versioned("sheetjs/js/load_from_server_dd.js")"></script>
    <script src="@controllers.routes.Assets.versioned("sheetjs/js/ddhideshow.js")"></script>
    <script src="@controllers.routes.Assets.versioned("sheetjs/vendor/spin.js")"></script>
    
    <script type="text/javascript">
    /* set up async GET request */
    var url = "@org.hadatac.console.controllers.annotator.routes.AutoAnnotator.downloadDataFile(dataFile.getId())".replace(/&amp;/g, '&');
    var _upload = document.getElementById('upload');    
    var _onreponse = function() {
    	$("#error_msg").html(decodeURIComponent(this.responseText));
    	setTimeout(function() {
    		$("#error_msg").html("");
    	}, 3000);
    };
    
    var req = new XMLHttpRequest();
    req.open("GET", url, true);
    req.responseType = "arraybuffer";

    req.onload = function(e) {
      var data = new Uint8Array(req.response);
      
      // var workbook = XLSX.read(data, {type:"array"});
      // console.log("SheetNames: " + workbook.SheetNames);

      DropSheet({
        data: data,
        file: _file,
        filetype: "@dataFile.getFileExtention()",
        drop: _target,
        upload: _upload,
        upload_url: "@org.hadatac.console.controllers.annotator.routes.AutoAnnotator.saveDataFile()",
        formdata: JSON.stringify({"fileId": "@dataFile.getId()"}),
        reponse_action: _onreponse,
        on: {
            workstart: _workstart,
            workend: _workend,
            sheet: _onsheet,
            foo: 'bar'
        },
        errors: {
            badfile: _badfile,
            pending: _pending,
            failed: _failed,
            large: _large,
            foo: 'bar'
        }
      });
    }
    req.send();
    </script>
}
